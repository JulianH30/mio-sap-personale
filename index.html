<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAP Personal Black Box</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #0a0a0a; color: #e5e5e5; font-family: 'Inter', sans-serif; }
        .glass { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .btn-active:active { transform: scale(0.95); transition: 0.1s; }
        .recording { animation: pulse 1s infinite; background-color: #ef4444 !important; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
    </style>
</head>
<body class="p-4 max-w-lg mx-auto min-h-screen flex flex-col">

    <div id="layerSystem" class="fixed inset-0 bg-black z-[200] flex flex-col items-center justify-center p-8">
        <h1 class="text-2xl font-bold text-emerald-500 mb-2">SISTEMA SAP</h1>
        <p class="text-[10px] text-gray-500 uppercase mb-8">Inserire PIN Generale</p>
        <input type="password" id="pinSys" class="bg-transparent border-b-2 border-emerald-500 w-full py-4 text-center text-3xl outline-none mb-8">
        <button onclick="accessSystem()" class="w-full bg-emerald-600 p-5 rounded-2xl font-bold">ACCEDI</button>
    </div>

    <div id="layerAuth" class="hidden fixed inset-0 bg-black z-[150] flex flex-col items-center justify-center p-8">
        <h2 id="authTitle" class="text-xl font-bold text-emerald-500 mb-2 uppercase"></h2>
        <p id="authDesc" class="text-[10px] text-gray-500 mb-8 text-center"></p>
        <input type="password" id="authInput" class="bg-transparent border-b-2 border-emerald-500 w-full py-4 text-center text-3xl outline-none mb-8">
        <button onclick="validateAuth()" class="w-full bg-emerald-600 p-5 rounded-2xl font-bold">CONFERMA</button>
        <button onclick="closeAuth()" class="mt-4 text-gray-600 text-xs">ANNULLA</button>
    </div>

    <div id="appContent" class="opacity-0 transition-opacity duration-500 flex-grow">
        <header class="mb-8 mt-4 flex justify-between items-center">
            <h1 class="text-2xl font-bold text-white">PERSONAL <span class="text-emerald-500">SAP</span></h1>
            <button onclick="openModule('Ricerca')" class="glass p-3 rounded-full">üîç</button>
        </header>

        <div class="grid grid-cols-2 gap-4 mb-8">
            <button onclick="requestAuth('Finanze')" class="glass p-6 rounded-2xl flex flex-col items-center btn-active">
                <span class="text-3xl mb-2">üí∞</span><span class="text-xs uppercase">Finanze</span>
            </button>
            <button onclick="requestAuth('Diario')" class="glass p-6 rounded-2xl flex flex-col items-center btn-active">
                <span class="text-3xl mb-2">‚úçÔ∏è</span><span class="text-xs uppercase">Diario</span>
            </button>
            <button onclick="requestAuth('Inventario')" class="glass p-6 rounded-2xl flex flex-col items-center btn-active">
                <span class="text-3xl mb-2">üì¶</span><span class="text-xs uppercase">Inventario</span>
            </button>
            <button onclick="requestAuth('Spesa')" class="glass p-6 rounded-2xl flex flex-col items-center btn-active border border-emerald-500/30">
                <span class="text-3xl mb-2">üõí</span><span class="text-xs uppercase text-emerald-500 font-bold">Spesa Casa</span>
            </button>
        </div>

        <footer class="mt-auto pb-6 text-center text-[10px] text-gray-600">
            Dev-Designer Hysenji ‚Ä¢ v19.0
        </footer>
    </div>

    <div id="modalSpesa" class="hidden fixed inset-0 bg-black bg-opacity-95 p-6 z-[100] flex flex-col">
        <h2 class="text-2xl font-bold text-emerald-500 mb-6 uppercase">üõí Lista Spesa</h2>
        <input type="text" id="spesaInput" placeholder="Cosa serve in casa?" class="bg-transparent border-b border-gray-800 w-full py-6 text-2xl outline-none mb-8">
        <button id="voiceSpesa" onclick="startVoiceSpesa()" class="w-full bg-gray-900 p-6 rounded-2xl mb-4 font-bold border border-gray-800">üéôÔ∏è AGGIUNGI CON VOCE</button>
        <button onclick="sendSpesa()" class="w-full bg-emerald-600 p-6 rounded-3xl font-black">INVIA A INFINITY PAPER</button>
        <button onclick="closeSpesa()" class="mt-8 text-gray-500">CHIUDI [X]</button>
    </div>

    <script>
        let pinSistema = localStorage.getItem('sap_pin_sys') || "";
        let userPin = "";
        let currentAction = "";
        const API_URL = "https://script.google.com/macros/s/AKfycbyu6aQo5v321Vr1mJLK_9dbiO0ETRbaSMott-O0sxshEyXCj0nW72ptIx-j0CLRMRpD/exec";
        const VALID_DOBS = ["01011970", "15051975", "20102000"]; // Inserisci qui le date senza barre per il controllo rapido

        if(pinSistema) {
            document.getElementById('layerSystem').classList.add('hidden');
            document.getElementById('appContent').classList.replace('opacity-0', 'opacity-100');
        }

        function accessSystem() {
            const p = document.getElementById('pinSys').value;
            if(p) {
                pinSistema = p;
                localStorage.setItem('sap_pin_sys', p);
                document.getElementById('layerSystem').classList.add('hidden');
                document.getElementById('appContent').classList.replace('opacity-0', 'opacity-100');
            }
        }

        function requestAuth(module) {
            currentAction = module;
            document.getElementById('layerAuth').classList.remove('hidden');
            document.getElementById('authInput').value = "";
            if(module === 'Spesa') {
                document.getElementById('authTitle').innerText = "Accesso Famiglia";
                document.getElementById('authDesc').innerText = "Inserisci la tua Data di Nascita (GGMMAAAA)";
            } else {
                document.getElementById('authTitle').innerText = "Accesso Riservato";
                document.getElementById('authDesc').innerText = "Inserisci lo User PIN (Hysenji)";
            }
        }

        function validateAuth() {
            const val = document.getElementById('authInput').value;
            if(currentAction === 'Spesa') {
                if(VALID_DOBS.includes(val)) {
                    document.getElementById('layerAuth').classList.add('hidden');
                    document.getElementById('modalSpesa').classList.remove('hidden');
                } else { alert("Data non autorizzata."); }
            } else {
                if(val === "Hysenji2026") {
                    userPin = val;
                    document.getElementById('layerAuth').classList.add('hidden');
                    alert("Accesso Moduli Privati Sbloccato.");
                    // Qui apriresti il modulo specifico (Finanze, Diario, ecc.)
                } else { alert("PIN Utente Errato."); }
            }
        }

        function closeAuth() { document.getElementById('layerAuth').classList.add('hidden'); }
        function closeSpesa() { document.getElementById('modalSpesa').classList.add('hidden'); }

        async function sendSpesa() {
            const obj = document.getElementById('spesaInput').value;
            if(!obj) return;
            const payload = {
                pinSistema: pinSistema,
                modulo: "Spesa",
                oggetto: obj,
                user: "Famiglia",
                note: "Aggiunto alla lista spesa"
            };
            await fetch(API_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(payload) });
            document.getElementById('spesaInput').value = "";
            alert("Aggiunto!");
            closeSpesa();
        }

        function startVoiceSpesa() {
            const rec = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            rec.lang = 'it-IT';
            rec.onresult = (e) => { document.getElementById('spesaInput').value = e.results[0][0].transcript; };
            rec.start();
        }
    </script>
</body>
</html>
